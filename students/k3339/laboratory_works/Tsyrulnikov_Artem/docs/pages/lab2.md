## Лабораторная работа: Туристическое агентство на Django

Во второй лабораторной работе я собрал полноценное приложение для турфирмы на Django. Проект покрывает регистрацию пользователей, каталог туров, бронирования, отзывы и сводку продаж. В качестве СУБД используется PostgreSQL, подключение настраивается через переменные окружения.

## Вариант задания

- Реализовать сайт туристической фирмы на Django 3 с PostgreSQL: каталог туров с описанием, периодом и условиями оплаты.
- Добавить регистрацию и авторизацию пользователей.
- Дать пользователю возможность бронировать туры, редактировать и удалять свои заявки.
- Реализовать отзывы с датами поездки, текстом, рейтингом 1–10 и данными автора.
- Обеспечить подтверждение бронирований администратором через Django Admin.
- Построить таблицу продаж по странам на клиентской стороне.
- Цель работы — отработать практику разработки web‑сервисов на Django (Python 3.6+, Django 3, PostgreSQL).

## Ход выполнения

## Задание 1: Модели и база данных
_Модели_

- `tours/models.py`: `Tour`, `Reservation`, `Review`. У тура храню описание, период, условия оплаты и бинарное поле для обложки (показываю его через `image_data_url`). Бронирование ссылается на пользователя, фиксирует даты поездки, статус и штамп времени. Отзывы привязаны к туру и сохраняют рейтинг от 1 до 10.

_PostgreSQL_

- `touragency/settings.py`: подключение к Postgres с дефолтами `app/user/password` и корректировкой через переменные `POSTGRES_*`.
- `docker-compose.yml`: поднимает локальный контейнер `postgres` той же конфигурации.

_Запуск миграций_

- `docker-compose up -d pg`
- `python manage.py migrate`

## Задание 2: Регистрация и аутентификация
_Формы_

- `tours/forms.py`: наследование от `UserCreationForm` и `AuthenticationForm` + миксин `BootstrapMixin`, который навешивает css-классы Bootstrap на все поля.

_Представления_

- `tours/views.py:register` и `logout_view`, а также `django.contrib.auth.views.LoginView` с кастомной формой.

_Шаблоны_

- `templates/tours/register.html` и `login.html`: формы регистрации/входа, адаптированные под Bootstrap, с выводом подсказок и ошибок.

## Задание 3: Каталог туров и бронирования
_Списки и детали_

- `TourListView` и `TourDetailView` под шаблоны `tour_list.html` и `tour_detail.html`. Страница списка показывает карточки с фото, датами и условиями оплаты, страница тура — полный текст и блок отзывов.

_Резервирование_

- `reserve_tour`, `my_reservations`, `reservation_update`, `reservation_delete`: ручки для создания, редактирования и удаления заявок. Валидация дат/гостей упирается в `ReservationForm`.
- `templates/tours/reservation_form.html` и `reservations.html`: формы и таблица с текущими заявками, кнопки для редактирования и удаления через POST.

_Уведомления_

- Использую `django.contrib.messages`, чтобы подсветить успешное бронирование, обновление или удаление (сообщения рендерятся в `base.html`).

## Задание 4: Отзывы и контроль рейтинга
_Модель_

- `Review.save()` проверяет, что рейтинг в диапазоне 1–10, иначе выбрасывает `ValueError`. Так ограничиваю ввод ещё до базы.

_Формы и представления_

- `ReviewForm` добавляет Datepicker ко всем датам и число с min/max для рейтинга.
- `add_review`: создаёт отзыв от имени текущего пользователя, после сохранения показывает всплывающее сообщение «Спасибо за отзыв!».

_Интерфейс_

- Блок отзывов на `tour_detail.html` выводит автора, рейтинг и интервал поездки, а форма доступна только авторизованным пользователям.

## Задание 5: Продажи по странам и админ-панель
_Админка_

- `tours/admin.py`: регистрирую все модели. Для туров добавил форму, которая умеет загружать фото, заменять или очищать его. Для бронирований и отзывов настроены фильтры и поиск, чтобы администратор быстро находил заявки и менял статус на `confirmed`.

_Отчет_

- `SalesByCountryView`: агрегирует подтверждённые брони (`status=confirmed`) и отдаёт таблицу вида «страна → кол-во». Шаблон `sales.html` подключен к меню и закрыт через `LoginRequiredMixin`.

_Навигация_

- В `base.html` отображаю разные кнопки для гостей и авторизованных пользователей: список туров, мои брони, отчёт по продажам, логин/регистрация/выход.

## Выводы
В проекте отработал базовую связку Django + PostgreSQL: объявление моделей, формы с bootstrap-стилями, CBV и FBV, работу со стандартной аутентификацией и сообщениями. Админ-панель покрывает административные сценарии, а клиентская часть даёт пользователю полный цикл — от просмотра туров до отзывов и просмотра подтверждённых продаж.
